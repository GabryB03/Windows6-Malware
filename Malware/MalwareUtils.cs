using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;

public class MalwareUtils
{
    [DllImport("user32.dll", SetLastError = true)]
    private static extern bool MoveWindow(IntPtr hWnd, int X, int Y, int nWidth, int nHeight, bool bRepaint);

    public static void RunMatrixEffect(int matrixEffects, bool doContinuosMoving, int continuosMovingDelay)
    {
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        List<Process> runProcesses = new List<Process>();
        Thread.Sleep(1000);

        for (int i = 0; i < matrixEffects; i++)
        {
            ProcessStartInfo processInfo = new ProcessStartInfo("cmd.exe", "/c \"" + rootDir + "\\MatrixEffect.bat\"");
            processInfo.CreateNoWindow = false;
            processInfo.UseShellExecute = false;
            Process process = Process.Start(processInfo);
            runProcesses.Add(process);

            while (process.MainWindowHandle.ToInt32() == 0)
            {
                Thread.Sleep(1);
            }

            MoveWindow(process.MainWindowHandle, Utils.random.GetRandomInt32(0, 800), Utils.random.GetRandomInt32(0, 500), 970, 500, true);
        }

        if (doContinuosMoving)
        {
            foreach (Process process in runProcesses)
            {
                new Thread(() =>
                {
                    while (true)
                    {
                        Thread.Sleep(continuosMovingDelay);

                        try
                        {
                            Process.GetProcessById(process.Id);

                            if (process.MainWindowHandle.ToInt32() != 0)
                            {
                                MoveWindow(process.MainWindowHandle, Utils.random.GetRandomInt32(0, 800), Utils.random.GetRandomInt32(0, 500), 970, 500, true);
                            }
                        }
                        catch
                        {
                            break;
                        }
                    }
                }).Start();
            }
        }

        Thread.Sleep(3250);

        foreach (Process process in runProcesses)
        {
            process.Kill();
        }

        runProcesses.Clear();
    }

    public static void DoWindows6Loading(int windows, int delay)
    {
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        List<Process> runProcesses = new List<Process>();
        Thread.Sleep(1000);
        int currentY = 0;

        for (int i = 0; i < windows; i++)
        {
            Thread.Sleep(delay);
            ProcessStartInfo processInfo = new ProcessStartInfo("cmd.exe", "/c \"" + rootDir + "\\Windows6Loading.bat\"");
            processInfo.CreateNoWindow = false;
            processInfo.UseShellExecute = false;
            Process process = Process.Start(processInfo);
            runProcesses.Add(process);

            while (process.MainWindowHandle.ToInt32() == 0)
            {
                Thread.Sleep(1);
            }

            MoveWindow(process.MainWindowHandle, 0, currentY, 970, 500, true);
            currentY += 10;
        }

        Thread.Sleep(1750);

        foreach (Process process in runProcesses)
        {
            process.Kill();
        }

        runProcesses.Clear();
    }
}